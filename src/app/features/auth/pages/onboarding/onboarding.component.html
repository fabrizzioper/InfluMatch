<div class="onboarding-container">
  <div class="onboarding-card">
    <!-- Header -->
    <div class="card-header">
      <h1>¡Completa tu perfil!</h1>
      <p *ngIf="user_type === 'influencer'">
        Para que las marcas puedan encontrarte, cuéntanos sobre ti.
      </p>
      <p *ngIf="user_type === 'marca'">
        Para encontrar los influencers adecuados, cuéntanos sobre tu marca.
      </p>
      <div class="logo">
        <img src="assets/images/logo-light.png" alt="InfluMatch" />
      </div>
    </div>

    <!-- Progress Steps -->
    <div class="steps-progress">
      <div class="step-item">
        <div
          class="step-circle"
          [ngClass]="{ active: currentStep === 1, completed: currentStep > 1 }"
        >
          <ng-container *ngIf="currentStep <= 1">1</ng-container>
          <span *ngIf="currentStep > 1">✓</span>
        </div>
        <div
          class="step-label"
          [ngClass]="{ active: currentStep === 1, completed: currentStep > 1 }"
        >
          Información básica
        </div>
      </div>
      <div class="step-item">
        <div
          class="step-circle"
          [ngClass]="{ active: currentStep === 2, completed: currentStep > 2 }"
        >
          <ng-container *ngIf="currentStep <= 2">2</ng-container>
          <span *ngIf="currentStep > 2">✓</span>
        </div>
        <div
          class="step-label"
          [ngClass]="{ active: currentStep === 2, completed: currentStep > 2 }"
        >
          {{
            user_type === "influencer" ? "Redes sociales" : "Detalles de marca"
          }}
        </div>
      </div>
      <div class="step-item">
        <div class="step-circle" [ngClass]="{ active: currentStep === 3 }">
          <ng-container *ngIf="currentStep <= 3">3</ng-container>
          <span *ngIf="currentStep > 3">✓</span>
        </div>
        <div class="step-label" [ngClass]="{ active: currentStep === 3 }">
          {{ user_type === "influencer" ? "Portafolio" : "Objetivos" }}
        </div>
      </div>
    </div>

    <!-- Form Content -->
    <form [formGroup]="form" (ngSubmit)="submit()">
      <div class="card-body">
        <!-- Step 1: Información básica (común para ambos) -->
        <div class="step-content" *ngIf="currentStep === 1">
          <h2 class="step-title">
            <div class="step-icon">👤</div>
            Información básica
          </h2>

          <div class="form-grid">
            <div class="form-field">
              <label>Nombre público <span class="required">*</span></label>
              <input
                type="text"
                formControlName="display_name"
                placeholder="Cómo aparecerás en la plataforma"
              />
              <div
                class="error-message"
                *ngIf="
                  form.get('display_name')?.invalid &&
                  form.get('display_name')?.touched
                "
              >
                Este campo es obligatorio
              </div>
            </div>

            <div class="form-field">
              <label>Ubicación <span class="required">*</span></label>
              <input
                type="text"
                formControlName="location"
                placeholder="Ciudad, País"
              />
              <div
                class="error-message"
                *ngIf="
                  form.get('location')?.invalid && form.get('location')?.touched
                "
              >
                Este campo es obligatorio
              </div>
            </div>

            <div class="form-field form-field-full">
              <label>Foto de perfil</label>
              <div class="image-upload">
                <div class="preview-container">
                  <img
                    *ngIf="imagePreview"
                    [src]="imagePreview"
                    class="preview-image"
                    alt="Vista previa"
                  />
                  <div
                    *ngIf="imagePreview"
                    class="remove-image"
                    (click)="removeImage()"
                  >
                    ✕
                  </div>
                  <div *ngIf="!imagePreview" class="upload-placeholder">
                    <p>📷 Sube una foto de perfil</p>
                  </div>
                </div>
                <label class="upload-button" (click)="fileInput.click()">
                  {{ imagePreview ? "🔄 Cambiar imagen" : "📤 Subir imagen" }}
                </label>
                <input
                  type="file"
                  #fileInput
                  style="display: none"
                  accept="image/*"
                  (change)="onFileSelected($event)"
                />
                <input type="hidden" formControlName="avatar_url" />
              </div>
            </div>

            <div class="form-field form-field-full">
              <label>Biografía <span class="required">*</span></label>
              <textarea
                formControlName="bio"
                placeholder="{{
                  user_type === 'influencer'
                    ? 'Cuéntanos sobre tu contenido y experiencia...'
                    : 'Cuéntanos sobre tu marca y los valores que representa...'
                }}"
              >
              </textarea>
              <div
                class="error-message"
                *ngIf="form.get('bio')?.invalid && form.get('bio')?.touched"
              >
                Este campo es obligatorio
              </div>
            </div>

            <div class="form-field">
              <label>Correo de contacto <span class="required">*</span></label>
              <input
                type="email"
                formControlName="contact_email"
                placeholder="email@ejemplo.com"
              />
              <div
                class="error-message"
                *ngIf="
                  form.get('contact_email')?.invalid &&
                  form.get('contact_email')?.touched
                "
              >
                Introduce un correo electrónico válido
              </div>
            </div>

            <div class="form-field" *ngIf="user_type === 'influencer'">
              <label>Nicho / Categoría <span class="required">*</span></label>
              <select formControlName="niche">
                <option value="">Selecciona una categoría</option>
                <option value="moda">Moda</option>
                <option value="belleza">Belleza</option>
                <option value="lifestyle">Lifestyle</option>
                <option value="fitness">Fitness</option>
                <option value="viajes">Viajes</option>
                <option value="tecnologia">Tecnología</option>
                <option value="gastronomia">Gastronomía</option>
                <option value="gaming">Gaming</option>
                <option value="otro">Otro</option>
              </select>
              <div
                class="error-message"
                *ngIf="form.get('niche')?.invalid && form.get('niche')?.touched"
              >
                Este campo es obligatorio
              </div>
            </div>

            <div class="form-field" *ngIf="user_type === 'marca'">
              <label>Sector / Industria <span class="required">*</span></label>
              <select formControlName="sector">
                <option value="">Selecciona un sector</option>
                <option value="moda">Moda</option>
                <option value="belleza">Belleza</option>
                <option value="tecnologia">Tecnología</option>
                <option value="alimentacion">Alimentación</option>
                <option value="hogar">Hogar y Decoración</option>
                <option value="salud">Salud</option>
                <option value="entretenimiento">Entretenimiento</option>
                <option value="otro">Otro</option>
              </select>
              <div
                class="error-message"
                *ngIf="
                  form.get('sector')?.invalid && form.get('sector')?.touched
                "
              >
                Este campo es obligatorio
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Redes sociales (Influencer) o Detalles de marca (Marca) -->
        <div class="step-content" *ngIf="currentStep === 2">
          <!-- Influencer: Redes sociales y seguidores -->
          <ng-container *ngIf="user_type === 'influencer'">
            <h2 class="step-title">
              <div class="step-icon">📱</div>
              Redes sociales y audiencia
            </h2>

            <div class="followers-section">
              <div class="followers-title">Seguidores por plataforma</div>
              <div class="followers-grid" formGroupName="followers">
                <div class="follower-item">
                  <div class="platform-header">
                    <div class="platform-icon instagram">📸</div>
                    <div class="platform-name">Instagram</div>
                  </div>
                  <input
                    type="number"
                    formControlName="instagram"
                    placeholder="Número de seguidores"
                  />
                </div>

                <div class="follower-item">
                  <div class="platform-header">
                    <div class="platform-icon tiktok">🎵</div>
                    <div class="platform-name">TikTok</div>
                  </div>
                  <input
                    type="number"
                    formControlName="tiktok"
                    placeholder="Número de seguidores"
                  />
                </div>

                <div class="follower-item">
                  <div class="platform-header">
                    <div class="platform-icon youtube">🎬</div>
                    <div class="platform-name">YouTube</div>
                  </div>
                  <input
                    type="number"
                    formControlName="youtube"
                    placeholder="Número de seguidores"
                  />
                </div>
              </div>
            </div>

            <div class="form-grid">
              <div class="form-field">
                <label
                  >Tarifa base por publicación (USD)
                  <span class="required">*</span></label
                >
                <input
                  type="number"
                  formControlName="rate_per_post"
                  placeholder="Ej: 500"
                />
                <div
                  class="error-message"
                  *ngIf="
                    form.get('rate_per_post')?.invalid &&
                    form.get('rate_per_post')?.touched
                  "
                >
                  Este campo es obligatorio
                </div>
              </div>

              <div class="form-field">
                <label>Engagement promedio (%)</label>
                <input
                  type="number"
                  formControlName="engagement_rate"
                  placeholder="Ej: 3.5"
                />
              </div>

              <div class="form-field">
                <label>Audiencia principal</label>
                <select formControlName="main_audience">
                  <option value="">Selecciona un rango</option>
                  <option value="18-24">18-24 años</option>
                  <option value="25-34">25-34 años</option>
                  <option value="35-44">35-44 años</option>
                  <option value="45+">45+ años</option>
                </select>
              </div>

              <div class="form-field">
                <label>Idiomas hablados</label>
                <select multiple formControlName="languages">
                  <option value="es">Español</option>
                  <option value="en">Inglés</option>
                  <option value="fr">Francés</option>
                  <option value="de">Alemán</option>
                  <option value="it">Italiano</option>
                  <option value="pt">Portugués</option>
                  <option value="other">Otro</option>
                </select>
              </div>
            </div>

            <div class="social-links" formGroupName="social_links">
              <h3>Enlaces a redes sociales</h3>

              <div class="social-link-item">
                <div class="social-icon instagram">📸</div>
                <input
                  type="text"
                  formControlName="instagram"
                  placeholder="@usuario"
                />
              </div>

              <div class="social-link-item">
                <div class="social-icon tiktok">🎵</div>
                <input
                  type="text"
                  formControlName="tiktok"
                  placeholder="@usuario"
                />
              </div>

              <div class="social-link-item">
                <div class="social-icon youtube">🎬</div>
                <input
                  type="text"
                  formControlName="youtube"
                  placeholder="URL del canal"
                />
              </div>

              <div class="social-link-item">
                <div class="social-icon twitter">🐦</div>
                <input
                  type="text"
                  formControlName="twitter"
                  placeholder="@usuario"
                />
              </div>

              <div class="social-link-item">
                <div class="social-icon facebook">👍</div>
                <input
                  type="text"
                  formControlName="facebook"
                  placeholder="URL del perfil"
                />
              </div>
            </div>
          </ng-container>

          <!-- Marca: Detalles de marca -->
          <ng-container *ngIf="user_type === 'marca'">
            <h2 class="step-title">
              <div class="step-icon">🏢</div>
              Detalles de marca
            </h2>

            <div class="form-grid">
              <div class="form-field">
                <label>Sitio web oficial</label>
                <input
                  type="url"
                  formControlName="website"
                  placeholder="https://www.ejemplo.com"
                />
              </div>

              <div class="form-field">
                <label
                  >Rango de presupuesto <span class="required">*</span></label
                >
                <select formControlName="budget_range">
                  <option value="">Selecciona un rango</option>
                  <option value="1000-5000">$1,000 - $5,000</option>
                  <option value="5000-10000">$5,000 - $10,000</option>
                  <option value="10000-50000">$10,000 - $50,000</option>
                  <option value="50000+">$50,000+</option>
                </select>
                <div
                  class="error-message"
                  *ngIf="
                    form.get('budget_range')?.invalid &&
                    form.get('budget_range')?.touched
                  "
                >
                  Este campo es obligatorio
                </div>
              </div>

              <div class="form-field form-field-full">
                <label>Tipo de contenido que buscas</label>
                <select multiple formControlName="content_types">
                  <option value="posts">Posts</option>
                  <option value="stories">Stories</option>
                  <option value="reels">Reels/TikToks</option>
                  <option value="video">Videos</option>
                  <option value="blogs">Blog Posts</option>
                </select>
              </div>

              <div class="form-field">
                <label>Persona de contacto</label>
                <input
                  type="text"
                  formControlName="contact_name"
                  placeholder="Nombre completo"
                />
              </div>

              <div class="form-field">
                <label>Cargo</label>
                <input
                  type="text"
                  formControlName="contact_position"
                  placeholder="Ej: Marketing Manager"
                />
              </div>

              <div class="form-field form-field-full">
                <label>Redes sociales de la marca</label>
                <div class="social-links" formGroupName="social_links">
                  <div class="social-link-item">
                    <div class="social-icon instagram">📸</div>
                    <input
                      type="text"
                      formControlName="instagram"
                      placeholder="@usuario"
                    />
                  </div>

                  <div class="social-link-item">
                    <div class="social-icon facebook">👍</div>
                    <input
                      type="text"
                      formControlName="facebook"
                      placeholder="URL del perfil"
                    />
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>

        <!-- Step 3: Portafolio (Influencer) o Objetivos (Marca) -->
        <div class="step-content" *ngIf="currentStep === 3">
          <!-- Influencer: Portafolio -->
          <ng-container *ngIf="user_type === 'influencer'">
            <h2 class="step-title">
              <div class="step-icon">🖼️</div>
              Portafolio
            </h2>

            <div class="portfolio-section">
              <div class="form-field">
                <label>URLs a posts destacados</label>
                <div class="portfolio-items" formArrayName="portfolio_urls">
                  <div
                    *ngFor="let url of portfolioUrls.controls; let i = index"
                    class="portfolio-item"
                  >
                    <input
                      type="text"
                      [formControlName]="i"
                      placeholder="https://"
                    />
                    <button
                      type="button"
                      class="remove-btn"
                      (click)="removePortfolioUrl(i)"
                    >
                      ✕
                    </button>
                  </div>
                </div>
                <button
                  type="button"
                  class="add-portfolio-btn"
                  (click)="addPortfolioUrl()"
                >
                  ➕ Añadir URL
                </button>
              </div>

              <div class="form-field">
                <label>Experiencia previa con marcas</label>
                <textarea
                  formControlName="previous_experience"
                  placeholder="Describe brevemente tu experiencia previa trabajando con marcas..."
                >
                </textarea>
              </div>

              <div class="form-field">
                <label>Categorías de productos preferidas</label>
                <select multiple formControlName="preferred_categories">
                  <option value="moda">Moda</option>
                  <option value="belleza">Belleza</option>
                  <option value="tecnologia">Tecnología</option>
                  <option value="alimentacion">Alimentación</option>
                  <option value="hogar">Hogar y Decoración</option>
                  <option value="salud">Salud</option>
                  <option value="entretenimiento">Entretenimiento</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
            </div>
          </ng-container>

          <!-- Marca: Objetivos -->
          <ng-container *ngIf="user_type === 'marca'">
            <h2 class="step-title">
              <div class="step-icon">🎯</div>
              Objetivos
            </h2>

            <div class="form-field">
              <label
                >Objetivos de campaña <span class="required">*</span></label
              >
              <textarea
                formControlName="objectives"
                placeholder="¿Qué buscas lograr con tus campañas de influencer marketing?"
              >
              </textarea>
              <div
                class="error-message"
                *ngIf="
                  form.get('objectives')?.invalid &&
                  form.get('objectives')?.touched
                "
              >
                Este campo es obligatorio
              </div>
            </div>

            <div class="form-field">
              <label>Tipo de influencers que buscas</label>
              <select multiple formControlName="influencer_types">
                <option value="micro">
                  Micro influencers (10K-50K seguidores)
                </option>
                <option value="mid">Mid-tier (50K-500K seguidores)</option>
                <option value="macro">
                  Macro influencers (500K-1M seguidores)
                </option>
                <option value="mega">Mega influencers (1M+ seguidores)</option>
              </select>
            </div>

            <div class="form-field">
              <label>Duración típica de campañas</label>
              <select formControlName="campaign_duration">
                <option value="">Selecciona una duración</option>
                <option value="one-time">Publicación única</option>
                <option value="short">Corta (1-2 semanas)</option>
                <option value="medium">Media (1 mes)</option>
                <option value="long">Larga (3+ meses)</option>
                <option value="ongoing">Colaboración continua</option>
              </select>
            </div>

            <div class="form-field">
              <label>Información adicional</label>
              <textarea
                formControlName="additional_info"
                placeholder="Cualquier otra información relevante para los influencers..."
              >
              </textarea>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Footer con botones de navegación -->
      <div class="card-footer">
        <button
          type="button"
          class="btn-back"
          [disabled]="currentStep === 1"
          (click)="prevStep()"
        >
          Anterior
        </button>

        <button
          *ngIf="currentStep < 3"
          type="button"
          class="btn-next"
          (click)="nextStep()"
        >
          Siguiente
        </button>

        <button
          *ngIf="currentStep === 3"
          type="submit"
          class="btn-submit"
          [disabled]="form.invalid"
          (click)="console.log(form.value)"
        >
          Finalizar
        </button>
      </div>
    </form>
  </div>
</div>
